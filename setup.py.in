#!/usr/bin/env python3
# Copyright 2020 Trail of Bits, all rights reserved.

import distutils.core
import os
import platform
import sys

if sys.version_info < (3, 7):
  print("Pasta is only supported on Python 3.7 and above.")
  exit(1)

PASTA_SRC_DIR = "@CMAKE_CURRENT_SOURCE_DIR@"
PASTA_BIN_DIR = "@CMAKE_CURRENT_BINARY_DIR@"

os.environ["CC"] = "@CMAKE_C_COMPILER@"
os.environ["CXX"] = "@CMAKE_CXX_COMPILER@"

INCLUDE_DIRS = list(set("@INCLUDE_DIRS@".split(";")))
LIBRARY_PATHS = list(set("@LIBRARY_PATHS@".split(";")))

pasta_internal = distutils.core.Extension(
    "pasta_internal",
    include_dirs=INCLUDE_DIRS,
    sources=[],
    extra_compile_args=["-std=c++17"],
    libraries=["curses"],
    extra_link_args=["-Wl,-force_load"] + ["$<TARGET_FILE:python_bindings>"] + LIBRARY_PATHS)

distutils.core.setup(
    name="pasta",
    version="0.1",
    description="Peter's Amazing Syntax Tree Analyzer",
    author="Trail of Bits",
    author_email="peter@trailofbits.com",
    url="https://github.com/trailofbits/pasta",
    license="Proprietary and confidential",
    py_modules=["pasta.__init__"],
    ext_modules=[pasta_internal])
